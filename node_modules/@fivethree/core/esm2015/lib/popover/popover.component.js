/**
 * @fileoverview added by tsickle
 * Generated from: lib/popover/popover.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { animIn, animOut } from './popover.animations';
import { DomSanitizer } from '@angular/platform-browser';
import { Component, ViewChild, Input, ViewEncapsulation, Host, Optional, ElementRef } from '@angular/core';
import { FivOverlay } from '../overlay/overlay.component';
import { Platform, IonContent } from '@ionic/angular';
import { fromEvent, Subject, merge, from } from 'rxjs';
import { tap, takeUntil, map, throttleTime, filter, flatMap } from 'rxjs/operators';
import { NavigationStart, Router } from '@angular/router';
import { after } from '@fivethree/ngx-rxjs-animations';
export class FivPopover {
    /**
     * @param {?} platform
     * @param {?} content
     * @param {?} dom
     * @param {?} router
     */
    constructor(platform, content, dom, router) {
        this.platform = platform;
        this.content = content;
        this.dom = dom;
        this.router = router;
        this.arrow = false;
        this.arrowWidth = 24;
        this.arrowHeight = this.arrowWidth / 1.6;
        this.arrowPosition = 'auto';
        this.backdrop = true;
        this.overlaysTarget = true;
        this.closeOnNavigation = true;
        this.scrollToTarget = false;
        this.scrollSpeed = 100;
        this.position = 'auto';
        this.classes = [];
        this.hidden = false;
        this.onDestroy$ = new Subject();
        this.onClose$ = new Subject();
        this.inDuration = 200;
        this.outDuration = 80;
        this.animationIn = (/**
         * @param {?} element
         * @return {?}
         */
        (element) => animIn(element, this._position, this.inDuration));
        this.animationOut = (/**
         * @param {?} element
         * @return {?}
         */
        (element) => animOut(element, this.outDuration));
    }
    /**
     * @return {?}
     */
    get styles() {
        if (!this._position) {
            return;
        }
        return this.dom.bypassSecurityTrustStyle(` width: ${this.width ? this.width + 'px' : 'auto'}; 
        height: ${this.height ? this.height + 'px' : 'auto'}; 
        left: ${this.getContainerLeft()}px; 
        top: ${this.getContainerTop()}px;`);
    }
    /**
     * @return {?}
     */
    get triangle() {
        /** @type {?} */
        const isHorizontal = ['left', 'right'].some((/**
         * @param {?} s
         * @return {?}
         */
        s => s === this.position));
        if (isHorizontal) {
            return `${this.arrowHeight},0 0,${this.arrowWidth / 2} ${this.arrowHeight},${this.arrowWidth}`;
        }
        return `0,${this.arrowHeight} ${this.arrowWidth / 2},0 ${this.arrowWidth},${this.arrowHeight}`;
    }
    /**
     * @return {?}
     */
    get svgStyles() {
        if (!this._position) {
            return;
        }
        /** @type {?} */
        const isHorizontal = ['left', 'right'].some((/**
         * @param {?} s
         * @return {?}
         */
        s => s === this.position));
        /** @type {?} */
        const rotate = (this.position === 'auto' && this._position.vertical === 'bottom') ||
            this.position === 'left';
        return this.dom.bypassSecurityTrustStyle(`height: ${isHorizontal ? this.arrowWidth : this.arrowHeight}px; 
      width: ${isHorizontal ? this.arrowHeight : this.arrowWidth}px; 
      top: ${this.getArrowTop()}px; 
      left: ${this.getArrowLeft()}px;
      transform: rotateZ(${rotate ? 180 : 0}deg);`);
    }
    /**
     * @return {?}
     */
    get animationStyles() {
        if (!this._position) {
            return;
        }
        return this.dom.bypassSecurityTrustStyle(`height: ${this.arrowHeight}px; 
      width: ${this.arrowWidth}px; 
      top: ${this.getArrowTop()}px; 
      left: ${this.getArrowLeft()}px;
      transform: rotateZ(${this._position.vertical === 'bottom' ? 180 : 0}deg);`);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.router.events
            .pipe(filter((/**
         * @param {?} event
         * @return {?}
         */
        event => event instanceof NavigationStart)), filter((/**
         * @return {?}
         */
        () => this.closeOnNavigation && this.overlay.open)), tap((/**
         * @return {?}
         */
        () => this.close())), takeUntil(this.onDestroy$))
            .subscribe();
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() { }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.onDestroy$.next();
    }
    /**
     * @return {?}
     */
    close() {
        this.animationOut(this.animationContainer)
            .pipe(after((/**
         * @return {?}
         */
        () => {
            this.overlay.hide();
            this.onClose$.next();
        })))
            .subscribe();
    }
    /**
     * @private
     * @param {?} target
     * @return {?}
     */
    getPositionOfTarget(target) {
        /** @type {?} */
        const rect = target.getBoundingClientRect();
        return this.calculcatePositioning(rect.top, rect.left, rect.bottom, rect.right, rect.height, rect.width);
    }
    /**
     * @param {?} target
     * @return {?}
     */
    open(target) {
        /** @type {?} */
        let element;
        if (target instanceof MouseEvent) {
            element = (/** @type {?} */ (target.target));
        }
        else if (target instanceof ElementRef) {
            element = (/** @type {?} */ (target.nativeElement));
        }
        else {
            return;
        }
        this.openTarget(element);
    }
    /**
     * @param {?} target
     * @return {?}
     */
    openTarget(target) {
        /** @type {?} */
        const position = this.getPositionOfTarget(target);
        this.openAtPosition(target, position);
        this.watchResize(target);
        this.watchScroll(target);
    }
    /**
     * @private
     * @param {?} target
     * @return {?}
     */
    watchResize(target) {
        fromEvent(window, 'resize')
            .pipe(flatMap((/**
         * @return {?}
         */
        () => this.filterInViewport(target))), throttleTime(50), map((/**
         * @return {?}
         */
        () => this.getPositionOfTarget(target))), tap((/**
         * @param {?} pos
         * @return {?}
         */
        pos => (this._position = pos))), takeUntil(this.onDestroy$))
            .subscribe();
    }
    /**
     * @private
     * @param {?} target
     * @return {?}
     */
    watchScroll(target) {
        if (this.content && !this.backdrop) {
            this.content.scrollEvents = true;
            merge(fromEvent(window, 'mousewheel'), fromEvent(window, 'touchmove'), this.content.ionScroll)
                .pipe(flatMap((/**
             * @return {?}
             */
            () => this.filterInViewport(target))), map((/**
             * @return {?}
             */
            () => this.getPositionOfTarget(target))), tap((/**
             * @param {?} pos
             * @return {?}
             */
            pos => (this._position = pos))), takeUntil(this.onDestroy$))
                .subscribe();
        }
    }
    /**
     * @private
     * @param {?} target
     * @return {?}
     */
    filterInViewport(target) {
        return from(this.inViewport(target.getBoundingClientRect())).pipe(tap((/**
         * @param {?} inViewport
         * @return {?}
         */
        inViewport => !inViewport ? (this.hidden = true) : (this.hidden = false))), filter((/**
         * @param {?} inViewPort
         * @return {?}
         */
        inViewPort => this.overlay.open && inViewPort)));
    }
    /**
     * @private
     * @param {?} target
     * @param {?} position
     * @return {?}
     */
    openAtPosition(target, position) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            yield this.scrollToPosition(target, position);
            this._position = position;
            this.overlay.show();
        });
    }
    /**
     * @private
     * @param {?} target
     * @param {?} position
     * @return {?}
     */
    scrollToPosition(target, position) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            if (this.content && this.scrollToTarget) {
                /** @type {?} */
                const isInViewport = yield this.inViewport(target.getBoundingClientRect());
                if (isInViewport) {
                    return;
                }
                yield this.content.scrollToPoint(position.left, position.top, this.scrollSpeed);
            }
        });
    }
    /**
     * @param {?} position
     * @return {?}
     */
    inViewport(position) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            /** @type {?} */
            const height = this.platform.height();
            /** @type {?} */
            const width = this.platform.width();
            return (position.top <= height &&
                position.bottom >= 0 &&
                position.left < width &&
                position.right > 0);
        });
    }
    /**
     * @private
     * @param {?} top
     * @param {?} left
     * @param {?} bottom
     * @param {?} right
     * @param {?} targetHeight
     * @param {?} targetWidth
     * @return {?}
     */
    calculcatePositioning(top, left, bottom, right, targetHeight, targetWidth) {
        // calculates the position of the popover without considering arrow and overlay offset
        /** @type {?} */
        const width = this.platform.width();
        /** @type {?} */
        const height = this.platform.height();
        /** @type {?} */
        const _left = this.position === 'right' ||
            (width / 2 > left && this.position !== 'left');
        /** @type {?} */
        const _right = this.position === 'left' ||
            (width / 2 <= left && this.position !== 'right');
        /** @type {?} */
        const _top = this.position === 'below' ||
            (height / 2 > top && this.position !== 'above');
        /** @type {?} */
        const _bottom = this.position === 'above' ||
            (height / 2 <= top && this.position !== 'below');
        // transform origin
        /** @type {?} */
        let horizontal = 'left';
        /** @type {?} */
        let vertical = 'top';
        if (_left && _top) {
            // top left
            horizontal = 'left';
            vertical = 'top';
        }
        else if (_right && _bottom) {
            // bottom right
            left = right - this.width;
            top = bottom - this.height;
            horizontal = 'right';
            vertical = 'bottom';
        }
        else if (_right && _top) {
            // top right
            left = right - this.width;
            horizontal = 'right';
            vertical = 'top';
        }
        else if (_left && _bottom) {
            // bottom left
            top = bottom - this.height;
            horizontal = 'left';
            vertical = 'bottom';
        }
        return {
            top,
            left,
            bottom,
            right,
            targetHeight,
            targetWidth,
            horizontal,
            vertical
        };
    }
    /**
     * @private
     * @return {?}
     */
    getArrowTop() {
        /** @type {?} */
        const isVert = ['auto', 'below', 'above'].some((/**
         * @param {?} s
         * @return {?}
         */
        s => s === this.position));
        if (isVert) {
            return this._position.vertical === 'top'
                ? -1 * this.arrowHeight
                : this.height;
        }
        if (this.arrowPosition === 'center') {
            return this.height / 2 - this.arrowWidth / 2;
        }
        return this._position.vertical === 'top'
            ? this._position.targetHeight / 2 - this.arrowHeight / 2
            : this.height - this.arrowHeight / 2 - this._position.targetHeight / 2;
    }
    /**
     * @private
     * @return {?}
     */
    getArrowLeft() {
        /** @type {?} */
        const isHorizontal = ['left', 'right'].some((/**
         * @param {?} s
         * @return {?}
         */
        s => s === this.position));
        if (isHorizontal) {
            return this._position.horizontal === 'left'
                ? -1 * this.arrowHeight
                : this.width;
        }
        if (this.arrowPosition === 'center') {
            return this.width / 2 - this.arrowHeight / 2;
        }
        return this._position.horizontal === 'left'
            ? this._position.targetWidth / 2 - this.arrowWidth / 2
            : this.width - this.arrowWidth / 2 - this._position.targetWidth / 2;
    }
    /**
     * @private
     * @return {?}
     */
    getContainerTop() {
        /** @type {?} */
        const isVert = ['auto', 'below', 'above'].some((/**
         * @param {?} s
         * @return {?}
         */
        s => s === this.position));
        /** @type {?} */
        const isTop = this._position.vertical === 'top';
        /** @type {?} */
        let offset = 0;
        if (this.arrow && isTop) {
            offset -= this.getVerticalArrowOffset();
        }
        else if (this.arrow && !isTop) {
            offset += this.getVerticalArrowOffset();
        }
        if (!isVert) {
            return this._position.top + offset;
        }
        if (!this.overlaysTarget && isTop) {
            offset += this._position.targetHeight;
        }
        else if (!this.overlaysTarget && !isTop) {
            offset -= this._position.targetHeight;
        }
        if (this.arrow && isTop) {
            offset += this.arrowHeight;
        }
        else if (this.arrow && !isTop) {
            offset -= this.arrowHeight;
        }
        return this._position.top + offset;
    }
    /**
     * @private
     * @return {?}
     */
    getVerticalArrowOffset() {
        /** @type {?} */
        let offset = 0;
        /** @type {?} */
        const isHorizontal = ['left', 'right'].some((/**
         * @param {?} s
         * @return {?}
         */
        s => s === this.position));
        if (this.arrowPosition === 'center' && isHorizontal) {
            offset += this.height / 2 - this._position.targetHeight / 2;
        }
        return offset;
    }
    /**
     * @private
     * @return {?}
     */
    getHorizontalArrowOffset() {
        /** @type {?} */
        let offset = 0;
        /** @type {?} */
        const isVertical = ['above', 'auto', 'below'].some((/**
         * @param {?} s
         * @return {?}
         */
        s => s === this.position));
        if (this.arrowPosition === 'center' && isVertical) {
            offset += this.width / 2 - this._position.targetWidth / 2;
        }
        return offset;
    }
    /**
     * @private
     * @return {?}
     */
    getContainerLeft() {
        /** @type {?} */
        const isHorizontal = ['left', 'right'].some((/**
         * @param {?} s
         * @return {?}
         */
        s => s === this.position));
        /** @type {?} */
        const isLeft = this._position.horizontal === 'left';
        /** @type {?} */
        let offset = 0;
        if (this.arrow && isLeft) {
            offset -= this.getHorizontalArrowOffset();
        }
        else if (this.arrow && !isLeft) {
            offset += this.getHorizontalArrowOffset();
        }
        if (!isHorizontal) {
            return this._position.left + offset;
        }
        if (!this.overlaysTarget && isLeft) {
            offset += this._position.targetWidth;
        }
        else if (!this.overlaysTarget && !isLeft) {
            offset -= this._position.targetWidth;
        }
        if (this.arrow && isLeft) {
            offset += this.arrowHeight;
        }
        else if (this.arrow && !isLeft) {
            offset -= this.arrowHeight;
        }
        return this._position.left + offset;
    }
}
FivPopover.decorators = [
    { type: Component, args: [{
                selector: 'fiv-popover',
                template: "<fiv-overlay>\n  <div *ngIf=\"backdrop && !hidden\" [ngClass]=\"classes\" class=\"fiv-popover-backdrop\" (click)=\"close()\">\n  </div>\n  <div *ngIf=\"!hidden\" [ngClass]=\"classes\" class=\"popover-container\" [style]=\"styles\">\n    <div #animation *ngIf=\"overlay?.open\" class=\"animation-container\" anim [anim.in]=\"animationIn\">\n      <ng-content>\n      </ng-content>\n      <svg *ngIf=\"arrow && !overlaysTarget\" class=\"arrow\" [style]=\"svgStyles\">\n        <polygon [attr.points]=\"triangle\" />\n      </svg>\n    </div>\n\n  </div>\n\n</fiv-overlay>",
                encapsulation: ViewEncapsulation.None,
                styles: [":host{--fiv-popover-backdrop-color:rgba(0, 0, 0, 0.2)}.popover-container{position:absolute;display:block}.animation-container{height:100%;position:relative}svg.arrow{position:absolute;fill:var(--ion-item-background)}.fiv-popover-backdrop{position:absolute;display:block;width:100vw;height:100vh;background:var(--fiv-popover-backdrop-color)}"]
            }] }
];
/** @nocollapse */
FivPopover.ctorParameters = () => [
    { type: Platform },
    { type: IonContent, decorators: [{ type: Host }, { type: Optional }] },
    { type: DomSanitizer },
    { type: Router }
];
FivPopover.propDecorators = {
    overlay: [{ type: ViewChild, args: [FivOverlay, { static: false },] }],
    animationContainer: [{ type: ViewChild, args: ['animation', { static: false },] }],
    width: [{ type: Input }],
    height: [{ type: Input }],
    arrow: [{ type: Input }],
    arrowWidth: [{ type: Input }],
    arrowHeight: [{ type: Input }],
    arrowPosition: [{ type: Input }],
    backdrop: [{ type: Input }],
    overlaysTarget: [{ type: Input }],
    closeOnNavigation: [{ type: Input }],
    scrollToTarget: [{ type: Input }],
    scrollSpeed: [{ type: Input }],
    position: [{ type: Input }],
    classes: [{ type: Input }],
    inDuration: [{ type: Input }],
    outDuration: [{ type: Input }],
    animationIn: [{ type: Input }],
    animationOut: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    FivPopover.prototype.overlay;
    /** @type {?} */
    FivPopover.prototype.animationContainer;
    /** @type {?} */
    FivPopover.prototype.width;
    /** @type {?} */
    FivPopover.prototype.height;
    /** @type {?} */
    FivPopover.prototype.arrow;
    /** @type {?} */
    FivPopover.prototype.arrowWidth;
    /** @type {?} */
    FivPopover.prototype.arrowHeight;
    /** @type {?} */
    FivPopover.prototype.arrowPosition;
    /** @type {?} */
    FivPopover.prototype.backdrop;
    /** @type {?} */
    FivPopover.prototype.overlaysTarget;
    /** @type {?} */
    FivPopover.prototype.closeOnNavigation;
    /** @type {?} */
    FivPopover.prototype.scrollToTarget;
    /** @type {?} */
    FivPopover.prototype.scrollSpeed;
    /** @type {?} */
    FivPopover.prototype.position;
    /** @type {?} */
    FivPopover.prototype.classes;
    /** @type {?} */
    FivPopover.prototype._position;
    /** @type {?} */
    FivPopover.prototype.hidden;
    /** @type {?} */
    FivPopover.prototype.onDestroy$;
    /** @type {?} */
    FivPopover.prototype.onClose$;
    /** @type {?} */
    FivPopover.prototype.inDuration;
    /** @type {?} */
    FivPopover.prototype.outDuration;
    /** @type {?} */
    FivPopover.prototype.animationIn;
    /** @type {?} */
    FivPopover.prototype.animationOut;
    /**
     * @type {?}
     * @private
     */
    FivPopover.prototype.platform;
    /**
     * @type {?}
     * @private
     */
    FivPopover.prototype.content;
    /**
     * @type {?}
     * @private
     */
    FivPopover.prototype.dom;
    /**
     * @type {?}
     * @private
     */
    FivPopover.prototype.router;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9wb3Zlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZml2ZXRocmVlL2NvcmUvIiwic291cmNlcyI6WyJsaWIvcG9wb3Zlci9wb3BvdmVyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUN6RCxPQUFPLEVBQ0wsU0FBUyxFQUVULFNBQVMsRUFDVCxLQUFLLEVBQ0wsaUJBQWlCLEVBQ2pCLElBQUksRUFDSixRQUFRLEVBRVIsVUFBVSxFQUVYLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsUUFBUSxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3RELE9BQU8sRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDdkQsT0FBTyxFQUNMLEdBQUcsRUFDSCxTQUFTLEVBQ1QsR0FBRyxFQUNILFlBQVksRUFDWixNQUFNLEVBQ04sT0FBTyxFQUNSLE1BQU0sZ0JBQWdCLENBQUM7QUFDeEIsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQVExRCxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFRdkQsTUFBTSxPQUFPLFVBQVU7Ozs7Ozs7SUFvRnJCLFlBQ1UsUUFBa0IsRUFDRSxPQUFtQixFQUN2QyxHQUFpQixFQUNqQixNQUFjO1FBSGQsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUNFLFlBQU8sR0FBUCxPQUFPLENBQVk7UUFDdkMsUUFBRyxHQUFILEdBQUcsQ0FBYztRQUNqQixXQUFNLEdBQU4sTUFBTSxDQUFRO1FBbEZmLFVBQUssR0FBRyxLQUFLLENBQUM7UUFDZCxlQUFVLEdBQUcsRUFBRSxDQUFDO1FBQ2hCLGdCQUFXLEdBQVcsSUFBSSxDQUFDLFVBQVUsR0FBRyxHQUFHLENBQUM7UUFDNUMsa0JBQWEsR0FBNEIsTUFBTSxDQUFDO1FBQ2hELGFBQVEsR0FBRyxJQUFJLENBQUM7UUFDaEIsbUJBQWMsR0FBRyxJQUFJLENBQUM7UUFDdEIsc0JBQWlCLEdBQUcsSUFBSSxDQUFDO1FBQ3pCLG1CQUFjLEdBQUcsS0FBSyxDQUFDO1FBQ3ZCLGdCQUFXLEdBQUcsR0FBRyxDQUFDO1FBQ2xCLGFBQVEsR0FBdUIsTUFBTSxDQUFDO1FBQ3RDLFlBQU8sR0FBYSxFQUFFLENBQUM7UUFHaEMsV0FBTSxHQUFHLEtBQUssQ0FBQztRQUNmLGVBQVUsR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFDO1FBQzNCLGFBQVEsR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFDO1FBRWhCLGVBQVUsR0FBRyxHQUFHLENBQUM7UUFDakIsZ0JBQVcsR0FBRyxFQUFFLENBQUM7UUFDakIsZ0JBQVc7Ozs7UUFBRyxDQUFDLE9BQW1CLEVBQUUsRUFBRSxDQUM3QyxNQUFNLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxFQUFDO1FBQzFDLGlCQUFZOzs7O1FBQUcsQ0FBQyxPQUFtQixFQUFFLEVBQUUsQ0FDOUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsV0FBVyxDQUFDLEVBQUM7SUE2RGxDLENBQUM7Ozs7SUEzREosSUFBSSxNQUFNO1FBQ1IsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDbkIsT0FBTztTQUNSO1FBQ0QsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLHdCQUF3QixDQUN0QyxXQUFXLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxNQUFNO2tCQUN0QyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsTUFBTTtnQkFDM0MsSUFBSSxDQUFDLGdCQUFnQixFQUFFO2VBQ3hCLElBQUksQ0FBQyxlQUFlLEVBQUUsS0FBSyxDQUNyQyxDQUFDO0lBQ0osQ0FBQzs7OztJQUVELElBQUksUUFBUTs7Y0FDSixZQUFZLEdBQUcsQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUMsSUFBSTs7OztRQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLElBQUksQ0FBQyxRQUFRLEVBQUM7UUFDckUsSUFBSSxZQUFZLEVBQUU7WUFDaEIsT0FBTyxHQUFHLElBQUksQ0FBQyxXQUFXLFFBQVEsSUFBSSxDQUFDLFVBQVUsR0FBRyxDQUFDLElBQ25ELElBQUksQ0FBQyxXQUNQLElBQUksSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1NBQ3ZCO1FBQ0QsT0FBTyxLQUFLLElBQUksQ0FBQyxXQUFXLElBQUksSUFBSSxDQUFDLFVBQVUsR0FBRyxDQUFDLE1BQU0sSUFBSSxDQUFDLFVBQVUsSUFDdEUsSUFBSSxDQUFDLFdBQ1AsRUFBRSxDQUFDO0lBQ0wsQ0FBQzs7OztJQUVELElBQUksU0FBUztRQUNYLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFO1lBQ25CLE9BQU87U0FDUjs7Y0FDSyxZQUFZLEdBQUcsQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUMsSUFBSTs7OztRQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLElBQUksQ0FBQyxRQUFRLEVBQUM7O2NBQy9ELE1BQU0sR0FDVixDQUFDLElBQUksQ0FBQyxRQUFRLEtBQUssTUFBTSxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxLQUFLLFFBQVEsQ0FBQztZQUNsRSxJQUFJLENBQUMsUUFBUSxLQUFLLE1BQU07UUFDMUIsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLHdCQUF3QixDQUN0QyxXQUFXLFlBQVksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVc7ZUFDbkQsWUFBWSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVTthQUNuRCxJQUFJLENBQUMsV0FBVyxFQUFFO2NBQ2pCLElBQUksQ0FBQyxZQUFZLEVBQUU7MkJBQ04sTUFBTSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUM3QyxDQUFDO0lBQ0osQ0FBQzs7OztJQUVELElBQUksZUFBZTtRQUNqQixJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRTtZQUNuQixPQUFPO1NBQ1I7UUFDRCxPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsd0JBQXdCLENBQ3RDLFdBQVcsSUFBSSxDQUFDLFdBQVc7ZUFDbEIsSUFBSSxDQUFDLFVBQVU7YUFDakIsSUFBSSxDQUFDLFdBQVcsRUFBRTtjQUNqQixJQUFJLENBQUMsWUFBWSxFQUFFOzJCQUNOLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FDM0UsQ0FBQztJQUNKLENBQUM7Ozs7SUFTRCxRQUFRO1FBQ04sSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNO2FBQ2YsSUFBSSxDQUNILE1BQU07Ozs7UUFBa0IsS0FBSyxDQUFDLEVBQUUsQ0FBQyxLQUFLLFlBQVksZUFBZSxFQUFDLEVBQ2xFLE1BQU07OztRQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksRUFBQyxFQUN6RCxHQUFHOzs7UUFBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLEVBQUMsRUFDdkIsU0FBUyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FDM0I7YUFDQSxTQUFTLEVBQUUsQ0FBQztJQUNqQixDQUFDOzs7O0lBRUQsZUFBZSxLQUFVLENBQUM7Ozs7SUFFMUIsV0FBVztRQUNULElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDekIsQ0FBQzs7OztJQUVELEtBQUs7UUFDSCxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQzthQUN2QyxJQUFJLENBQ0gsS0FBSzs7O1FBQUMsR0FBRyxFQUFFO1lBQ1QsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUNwQixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ3ZCLENBQUMsRUFBQyxDQUNIO2FBQ0EsU0FBUyxFQUFFLENBQUM7SUFDakIsQ0FBQzs7Ozs7O0lBRU8sbUJBQW1CLENBQUMsTUFBbUI7O2NBQ3ZDLElBQUksR0FBRyxNQUFNLENBQUMscUJBQXFCLEVBQUU7UUFDM0MsT0FBTyxJQUFJLENBQUMscUJBQXFCLENBQy9CLElBQUksQ0FBQyxHQUFHLEVBQ1IsSUFBSSxDQUFDLElBQUksRUFDVCxJQUFJLENBQUMsTUFBTSxFQUNYLElBQUksQ0FBQyxLQUFLLEVBQ1YsSUFBSSxDQUFDLE1BQU0sRUFDWCxJQUFJLENBQUMsS0FBSyxDQUNYLENBQUM7SUFDSixDQUFDOzs7OztJQUVELElBQUksQ0FBQyxNQUErQjs7WUFDOUIsT0FBTztRQUNYLElBQUksTUFBTSxZQUFZLFVBQVUsRUFBRTtZQUNoQyxPQUFPLEdBQUcsbUJBQUEsTUFBTSxDQUFDLE1BQU0sRUFBZSxDQUFDO1NBQ3hDO2FBQU0sSUFBSSxNQUFNLFlBQVksVUFBVSxFQUFFO1lBQ3ZDLE9BQU8sR0FBRyxtQkFBQSxNQUFNLENBQUMsYUFBYSxFQUFlLENBQUM7U0FDL0M7YUFBTTtZQUNMLE9BQU87U0FDUjtRQUNELElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDM0IsQ0FBQzs7Ozs7SUFFRCxVQUFVLENBQUMsTUFBbUI7O2NBQ3RCLFFBQVEsR0FBRyxJQUFJLENBQUMsbUJBQW1CLENBQUMsTUFBTSxDQUFDO1FBQ2pELElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQ3RDLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDekIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUMzQixDQUFDOzs7Ozs7SUFFTyxXQUFXLENBQUMsTUFBbUI7UUFDckMsU0FBUyxDQUFDLE1BQU0sRUFBRSxRQUFRLENBQUM7YUFDeEIsSUFBSSxDQUNILE9BQU87OztRQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsRUFBQyxFQUM1QyxZQUFZLENBQUMsRUFBRSxDQUFDLEVBQ2hCLEdBQUc7OztRQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxNQUFNLENBQUMsRUFBQyxFQUMzQyxHQUFHOzs7O1FBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLEdBQUcsR0FBRyxDQUFDLEVBQUMsRUFDbEMsU0FBUyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FDM0I7YUFDQSxTQUFTLEVBQUUsQ0FBQztJQUNqQixDQUFDOzs7Ozs7SUFFTyxXQUFXLENBQUMsTUFBbUI7UUFDckMsSUFBSSxJQUFJLENBQUMsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNsQyxJQUFJLENBQUMsT0FBTyxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUM7WUFDakMsS0FBSyxDQUNILFNBQVMsQ0FBQyxNQUFNLEVBQUUsWUFBWSxDQUFDLEVBQy9CLFNBQVMsQ0FBQyxNQUFNLEVBQUUsV0FBVyxDQUFDLEVBQzlCLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUN2QjtpQkFDRSxJQUFJLENBQ0gsT0FBTzs7O1lBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxFQUFDLEVBQzVDLEdBQUc7OztZQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxNQUFNLENBQUMsRUFBQyxFQUMzQyxHQUFHOzs7O1lBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLEdBQUcsR0FBRyxDQUFDLEVBQUMsRUFDbEMsU0FBUyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FDM0I7aUJBQ0EsU0FBUyxFQUFFLENBQUM7U0FDaEI7SUFDSCxDQUFDOzs7Ozs7SUFFTyxnQkFBZ0IsQ0FBQyxNQUFtQjtRQUMxQyxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQy9ELEdBQUc7Ozs7UUFBQyxVQUFVLENBQUMsRUFBRSxDQUNmLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUMsRUFDM0QsRUFDRCxNQUFNOzs7O1FBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksSUFBSSxVQUFVLEVBQUMsQ0FDdEQsQ0FBQztJQUNKLENBQUM7Ozs7Ozs7SUFFYSxjQUFjLENBQUMsTUFBbUIsRUFBRSxRQUF5Qjs7WUFDekUsTUFBTSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBQzlDLElBQUksQ0FBQyxTQUFTLEdBQUcsUUFBUSxDQUFDO1lBQzFCLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDdEIsQ0FBQztLQUFBOzs7Ozs7O0lBRWEsZ0JBQWdCLENBQzVCLE1BQW1CLEVBQ25CLFFBQXlCOztZQUV6QixJQUFJLElBQUksQ0FBQyxPQUFPLElBQUksSUFBSSxDQUFDLGNBQWMsRUFBRTs7c0JBQ2pDLFlBQVksR0FBRyxNQUFNLElBQUksQ0FBQyxVQUFVLENBQ3hDLE1BQU0sQ0FBQyxxQkFBcUIsRUFBRSxDQUMvQjtnQkFDRCxJQUFJLFlBQVksRUFBRTtvQkFDaEIsT0FBTztpQkFDUjtnQkFDRCxNQUFNLElBQUksQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUM5QixRQUFRLENBQUMsSUFBSSxFQUNiLFFBQVEsQ0FBQyxHQUFHLEVBQ1osSUFBSSxDQUFDLFdBQVcsQ0FDakIsQ0FBQzthQUNIO1FBQ0gsQ0FBQztLQUFBOzs7OztJQUNLLFVBQVUsQ0FBQyxRQUE4Qjs7O2tCQUN2QyxNQUFNLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUU7O2tCQUMvQixLQUFLLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUU7WUFFbkMsT0FBTyxDQUNMLFFBQVEsQ0FBQyxHQUFHLElBQUksTUFBTTtnQkFDdEIsUUFBUSxDQUFDLE1BQU0sSUFBSSxDQUFDO2dCQUNwQixRQUFRLENBQUMsSUFBSSxHQUFHLEtBQUs7Z0JBQ3JCLFFBQVEsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUNuQixDQUFDO1FBQ0osQ0FBQztLQUFBOzs7Ozs7Ozs7OztJQUVPLHFCQUFxQixDQUMzQixHQUFXLEVBQ1gsSUFBWSxFQUNaLE1BQWMsRUFDZCxLQUFhLEVBQ2IsWUFBb0IsRUFDcEIsV0FBbUI7OztjQUdiLEtBQUssR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRTs7Y0FDN0IsTUFBTSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFOztjQUUvQixLQUFLLEdBQ1QsSUFBSSxDQUFDLFFBQVEsS0FBSyxPQUFPO1lBQ3pCLENBQUMsS0FBSyxHQUFHLENBQUMsR0FBRyxJQUFJLElBQUksSUFBSSxDQUFDLFFBQVEsS0FBSyxNQUFNLENBQUM7O2NBQzFDLE1BQU0sR0FDVixJQUFJLENBQUMsUUFBUSxLQUFLLE1BQU07WUFDeEIsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxJQUFJLElBQUksSUFBSSxJQUFJLENBQUMsUUFBUSxLQUFLLE9BQU8sQ0FBQzs7Y0FDNUMsSUFBSSxHQUNSLElBQUksQ0FBQyxRQUFRLEtBQUssT0FBTztZQUN6QixDQUFDLE1BQU0sR0FBRyxDQUFDLEdBQUcsR0FBRyxJQUFJLElBQUksQ0FBQyxRQUFRLEtBQUssT0FBTyxDQUFDOztjQUMzQyxPQUFPLEdBQ1gsSUFBSSxDQUFDLFFBQVEsS0FBSyxPQUFPO1lBQ3pCLENBQUMsTUFBTSxHQUFHLENBQUMsSUFBSSxHQUFHLElBQUksSUFBSSxDQUFDLFFBQVEsS0FBSyxPQUFPLENBQUM7OztZQUc5QyxVQUFVLEdBQTJCLE1BQU07O1lBQzNDLFFBQVEsR0FBeUIsS0FBSztRQUUxQyxJQUFJLEtBQUssSUFBSSxJQUFJLEVBQUU7WUFDakIsV0FBVztZQUNYLFVBQVUsR0FBRyxNQUFNLENBQUM7WUFDcEIsUUFBUSxHQUFHLEtBQUssQ0FBQztTQUNsQjthQUFNLElBQUksTUFBTSxJQUFJLE9BQU8sRUFBRTtZQUM1QixlQUFlO1lBQ2YsSUFBSSxHQUFHLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO1lBQzFCLEdBQUcsR0FBRyxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztZQUMzQixVQUFVLEdBQUcsT0FBTyxDQUFDO1lBQ3JCLFFBQVEsR0FBRyxRQUFRLENBQUM7U0FDckI7YUFBTSxJQUFJLE1BQU0sSUFBSSxJQUFJLEVBQUU7WUFDekIsWUFBWTtZQUNaLElBQUksR0FBRyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztZQUMxQixVQUFVLEdBQUcsT0FBTyxDQUFDO1lBQ3JCLFFBQVEsR0FBRyxLQUFLLENBQUM7U0FDbEI7YUFBTSxJQUFJLEtBQUssSUFBSSxPQUFPLEVBQUU7WUFDM0IsY0FBYztZQUNkLEdBQUcsR0FBRyxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztZQUMzQixVQUFVLEdBQUcsTUFBTSxDQUFDO1lBQ3BCLFFBQVEsR0FBRyxRQUFRLENBQUM7U0FDckI7UUFFRCxPQUFPO1lBQ0wsR0FBRztZQUNILElBQUk7WUFDSixNQUFNO1lBQ04sS0FBSztZQUNMLFlBQVk7WUFDWixXQUFXO1lBQ1gsVUFBVTtZQUNWLFFBQVE7U0FDVCxDQUFDO0lBQ0osQ0FBQzs7Ozs7SUFFTyxXQUFXOztjQUNYLE1BQU0sR0FBRyxDQUFDLE1BQU0sRUFBRSxPQUFPLEVBQUUsT0FBTyxDQUFDLENBQUMsSUFBSTs7OztRQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLElBQUksQ0FBQyxRQUFRLEVBQUM7UUFDeEUsSUFBSSxNQUFNLEVBQUU7WUFDVixPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxLQUFLLEtBQUs7Z0JBQ3RDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsV0FBVztnQkFDdkIsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7U0FDakI7UUFDRCxJQUFJLElBQUksQ0FBQyxhQUFhLEtBQUssUUFBUSxFQUFFO1lBQ25DLE9BQU8sSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUM7U0FDOUM7UUFDRCxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxLQUFLLEtBQUs7WUFDdEMsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsWUFBWSxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsV0FBVyxHQUFHLENBQUM7WUFDeEQsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLFdBQVcsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxZQUFZLEdBQUcsQ0FBQyxDQUFDO0lBQzNFLENBQUM7Ozs7O0lBRU8sWUFBWTs7Y0FDWixZQUFZLEdBQUcsQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUMsSUFBSTs7OztRQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLElBQUksQ0FBQyxRQUFRLEVBQUM7UUFDckUsSUFBSSxZQUFZLEVBQUU7WUFDaEIsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLFVBQVUsS0FBSyxNQUFNO2dCQUN6QyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLFdBQVc7Z0JBQ3ZCLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDO1NBQ2hCO1FBQ0QsSUFBSSxJQUFJLENBQUMsYUFBYSxLQUFLLFFBQVEsRUFBRTtZQUNuQyxPQUFPLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxXQUFXLEdBQUcsQ0FBQyxDQUFDO1NBQzlDO1FBQ0QsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLFVBQVUsS0FBSyxNQUFNO1lBQ3pDLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFdBQVcsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLFVBQVUsR0FBRyxDQUFDO1lBQ3RELENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxVQUFVLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsV0FBVyxHQUFHLENBQUMsQ0FBQztJQUN4RSxDQUFDOzs7OztJQUVPLGVBQWU7O2NBQ2YsTUFBTSxHQUFHLENBQUMsTUFBTSxFQUFFLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQyxJQUFJOzs7O1FBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLFFBQVEsRUFBQzs7Y0FDbEUsS0FBSyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxLQUFLLEtBQUs7O1lBRTNDLE1BQU0sR0FBRyxDQUFDO1FBQ2QsSUFBSSxJQUFJLENBQUMsS0FBSyxJQUFJLEtBQUssRUFBRTtZQUN2QixNQUFNLElBQUksSUFBSSxDQUFDLHNCQUFzQixFQUFFLENBQUM7U0FDekM7YUFBTSxJQUFJLElBQUksQ0FBQyxLQUFLLElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDL0IsTUFBTSxJQUFJLElBQUksQ0FBQyxzQkFBc0IsRUFBRSxDQUFDO1NBQ3pDO1FBQ0QsSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUNYLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLEdBQUcsTUFBTSxDQUFDO1NBQ3BDO1FBQ0QsSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLElBQUksS0FBSyxFQUFFO1lBQ2pDLE1BQU0sSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLFlBQVksQ0FBQztTQUN2QzthQUFNLElBQUksQ0FBQyxJQUFJLENBQUMsY0FBYyxJQUFJLENBQUMsS0FBSyxFQUFFO1lBQ3pDLE1BQU0sSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLFlBQVksQ0FBQztTQUN2QztRQUVELElBQUksSUFBSSxDQUFDLEtBQUssSUFBSSxLQUFLLEVBQUU7WUFDdkIsTUFBTSxJQUFJLElBQUksQ0FBQyxXQUFXLENBQUM7U0FDNUI7YUFBTSxJQUFJLElBQUksQ0FBQyxLQUFLLElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDL0IsTUFBTSxJQUFJLElBQUksQ0FBQyxXQUFXLENBQUM7U0FDNUI7UUFDRCxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxHQUFHLE1BQU0sQ0FBQztJQUNyQyxDQUFDOzs7OztJQUVPLHNCQUFzQjs7WUFDeEIsTUFBTSxHQUFHLENBQUM7O2NBQ1IsWUFBWSxHQUFHLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFDLElBQUk7Ozs7UUFBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxJQUFJLENBQUMsUUFBUSxFQUFDO1FBQ3JFLElBQUksSUFBSSxDQUFDLGFBQWEsS0FBSyxRQUFRLElBQUksWUFBWSxFQUFFO1lBQ25ELE1BQU0sSUFBSSxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFlBQVksR0FBRyxDQUFDLENBQUM7U0FDN0Q7UUFDRCxPQUFPLE1BQU0sQ0FBQztJQUNoQixDQUFDOzs7OztJQUNPLHdCQUF3Qjs7WUFDMUIsTUFBTSxHQUFHLENBQUM7O2NBQ1IsVUFBVSxHQUFHLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQyxJQUFJOzs7O1FBQ2hELENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLElBQUksQ0FBQyxRQUFRLEVBQ3pCO1FBQ0QsSUFBSSxJQUFJLENBQUMsYUFBYSxLQUFLLFFBQVEsSUFBSSxVQUFVLEVBQUU7WUFDakQsTUFBTSxJQUFJLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsV0FBVyxHQUFHLENBQUMsQ0FBQztTQUMzRDtRQUNELE9BQU8sTUFBTSxDQUFDO0lBQ2hCLENBQUM7Ozs7O0lBRU8sZ0JBQWdCOztjQUNoQixZQUFZLEdBQUcsQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUMsSUFBSTs7OztRQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLElBQUksQ0FBQyxRQUFRLEVBQUM7O2NBQy9ELE1BQU0sR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFVBQVUsS0FBSyxNQUFNOztZQUUvQyxNQUFNLEdBQUcsQ0FBQztRQUNkLElBQUksSUFBSSxDQUFDLEtBQUssSUFBSSxNQUFNLEVBQUU7WUFDeEIsTUFBTSxJQUFJLElBQUksQ0FBQyx3QkFBd0IsRUFBRSxDQUFDO1NBQzNDO2FBQU0sSUFBSSxJQUFJLENBQUMsS0FBSyxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ2hDLE1BQU0sSUFBSSxJQUFJLENBQUMsd0JBQXdCLEVBQUUsQ0FBQztTQUMzQztRQUVELElBQUksQ0FBQyxZQUFZLEVBQUU7WUFDakIsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksR0FBRyxNQUFNLENBQUM7U0FDckM7UUFDRCxJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsSUFBSSxNQUFNLEVBQUU7WUFDbEMsTUFBTSxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDO1NBQ3RDO2FBQU0sSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDMUMsTUFBTSxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDO1NBQ3RDO1FBRUQsSUFBSSxJQUFJLENBQUMsS0FBSyxJQUFJLE1BQU0sRUFBRTtZQUN4QixNQUFNLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQztTQUM1QjthQUFNLElBQUksSUFBSSxDQUFDLEtBQUssSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUNoQyxNQUFNLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQztTQUM1QjtRQUNELE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEdBQUcsTUFBTSxDQUFDO0lBQ3RDLENBQUM7OztZQTVZRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLGFBQWE7Z0JBQ3ZCLHFrQkFBdUM7Z0JBRXZDLGFBQWEsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJOzthQUN0Qzs7OztZQXpCUSxRQUFRO1lBQUUsVUFBVSx1QkFnSHhCLElBQUksWUFBSSxRQUFRO1lBOUhaLFlBQVk7WUF3QkssTUFBTTs7O3NCQWlCN0IsU0FBUyxTQUFDLFVBQVUsRUFBRSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUU7aUNBQ3ZDLFNBQVMsU0FBQyxXQUFXLEVBQUUsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFO29CQUV4QyxLQUFLO3FCQUNMLEtBQUs7b0JBQ0wsS0FBSzt5QkFDTCxLQUFLOzBCQUNMLEtBQUs7NEJBQ0wsS0FBSzt1QkFDTCxLQUFLOzZCQUNMLEtBQUs7Z0NBQ0wsS0FBSzs2QkFDTCxLQUFLOzBCQUNMLEtBQUs7dUJBQ0wsS0FBSztzQkFDTCxLQUFLO3lCQU9MLEtBQUs7MEJBQ0wsS0FBSzswQkFDTCxLQUFLOzJCQUVMLEtBQUs7Ozs7SUExQk4sNkJBQThEOztJQUM5RCx3Q0FBMEU7O0lBRTFFLDJCQUF1Qjs7SUFDdkIsNEJBQXdCOztJQUN4QiwyQkFBdUI7O0lBQ3ZCLGdDQUF5Qjs7SUFDekIsaUNBQXFEOztJQUNyRCxtQ0FBeUQ7O0lBQ3pELDhCQUF5Qjs7SUFDekIsb0NBQStCOztJQUMvQix1Q0FBa0M7O0lBQ2xDLG9DQUFnQzs7SUFDaEMsaUNBQTJCOztJQUMzQiw4QkFBK0M7O0lBQy9DLDZCQUFnQzs7SUFFaEMsK0JBQTJCOztJQUMzQiw0QkFBZTs7SUFDZixnQ0FBMkI7O0lBQzNCLDhCQUF5Qjs7SUFFekIsZ0NBQTBCOztJQUMxQixpQ0FBMEI7O0lBQzFCLGlDQUNtRDs7SUFDbkQsa0NBQ3FDOzs7OztJQXlEbkMsOEJBQTBCOzs7OztJQUMxQiw2QkFBK0M7Ozs7O0lBQy9DLHlCQUF5Qjs7Ozs7SUFDekIsNEJBQXNCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYW5pbUluLCBhbmltT3V0IH0gZnJvbSAnLi9wb3BvdmVyLmFuaW1hdGlvbnMnO1xuaW1wb3J0IHsgRG9tU2FuaXRpemVyIH0gZnJvbSAnQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3Nlcic7XG5pbXBvcnQge1xuICBDb21wb25lbnQsXG4gIE9uSW5pdCxcbiAgVmlld0NoaWxkLFxuICBJbnB1dCxcbiAgVmlld0VuY2Fwc3VsYXRpb24sXG4gIEhvc3QsXG4gIE9wdGlvbmFsLFxuICBBZnRlclZpZXdJbml0LFxuICBFbGVtZW50UmVmLFxuICBPbkRlc3Ryb3lcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBGaXZPdmVybGF5IH0gZnJvbSAnLi4vb3ZlcmxheS9vdmVybGF5LmNvbXBvbmVudCc7XG5pbXBvcnQgeyBQbGF0Zm9ybSwgSW9uQ29udGVudCB9IGZyb20gJ0Bpb25pYy9hbmd1bGFyJztcbmltcG9ydCB7IGZyb21FdmVudCwgU3ViamVjdCwgbWVyZ2UsIGZyb20gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7XG4gIHRhcCxcbiAgdGFrZVVudGlsLFxuICBtYXAsXG4gIHRocm90dGxlVGltZSxcbiAgZmlsdGVyLFxuICBmbGF0TWFwXG59IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IE5hdmlnYXRpb25TdGFydCwgUm91dGVyIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbmltcG9ydCB7XG4gIFBvcG92ZXJQb3NpdGlvbmluZyxcbiAgUG9wb3ZlclBvc2l0aW9uLFxuICBQb3BvdmVySG9yaXpvbnRhbEFsaWduLFxuICBQb3BvdmVyVmVydGljYWxBbGlnbixcbiAgUG9wb3ZlckFycm93UG9zaXRpb25pbmdcbn0gZnJvbSAnLi9wb3BvdmVyLnR5cGVzJztcbmltcG9ydCB7IGFmdGVyIH0gZnJvbSAnQGZpdmV0aHJlZS9uZ3gtcnhqcy1hbmltYXRpb25zJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnZml2LXBvcG92ZXInLFxuICB0ZW1wbGF0ZVVybDogJy4vcG9wb3Zlci5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3BvcG92ZXIuY29tcG9uZW50LnNjc3MnXSxcbiAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZVxufSlcbmV4cG9ydCBjbGFzcyBGaXZQb3BvdmVyIGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xuICBAVmlld0NoaWxkKEZpdk92ZXJsYXksIHsgc3RhdGljOiBmYWxzZSB9KSBvdmVybGF5OiBGaXZPdmVybGF5O1xuICBAVmlld0NoaWxkKCdhbmltYXRpb24nLCB7IHN0YXRpYzogZmFsc2UgfSkgYW5pbWF0aW9uQ29udGFpbmVyOiBFbGVtZW50UmVmO1xuXG4gIEBJbnB1dCgpIHdpZHRoOiBudW1iZXI7XG4gIEBJbnB1dCgpIGhlaWdodDogbnVtYmVyO1xuICBASW5wdXQoKSBhcnJvdyA9IGZhbHNlO1xuICBASW5wdXQoKSBhcnJvd1dpZHRoID0gMjQ7XG4gIEBJbnB1dCgpIGFycm93SGVpZ2h0OiBudW1iZXIgPSB0aGlzLmFycm93V2lkdGggLyAxLjY7XG4gIEBJbnB1dCgpIGFycm93UG9zaXRpb246IFBvcG92ZXJBcnJvd1Bvc2l0aW9uaW5nID0gJ2F1dG8nO1xuICBASW5wdXQoKSBiYWNrZHJvcCA9IHRydWU7XG4gIEBJbnB1dCgpIG92ZXJsYXlzVGFyZ2V0ID0gdHJ1ZTtcbiAgQElucHV0KCkgY2xvc2VPbk5hdmlnYXRpb24gPSB0cnVlO1xuICBASW5wdXQoKSBzY3JvbGxUb1RhcmdldCA9IGZhbHNlO1xuICBASW5wdXQoKSBzY3JvbGxTcGVlZCA9IDEwMDtcbiAgQElucHV0KCkgcG9zaXRpb246IFBvcG92ZXJQb3NpdGlvbmluZyA9ICdhdXRvJztcbiAgQElucHV0KCkgY2xhc3Nlczogc3RyaW5nW10gPSBbXTtcblxuICBfcG9zaXRpb246IFBvcG92ZXJQb3NpdGlvbjtcbiAgaGlkZGVuID0gZmFsc2U7XG4gIG9uRGVzdHJveSQgPSBuZXcgU3ViamVjdCgpO1xuICBvbkNsb3NlJCA9IG5ldyBTdWJqZWN0KCk7XG5cbiAgQElucHV0KCkgaW5EdXJhdGlvbiA9IDIwMDtcbiAgQElucHV0KCkgb3V0RHVyYXRpb24gPSA4MDtcbiAgQElucHV0KCkgYW5pbWF0aW9uSW4gPSAoZWxlbWVudDogRWxlbWVudFJlZikgPT5cbiAgICBhbmltSW4oZWxlbWVudCwgdGhpcy5fcG9zaXRpb24sIHRoaXMuaW5EdXJhdGlvbik7XG4gIEBJbnB1dCgpIGFuaW1hdGlvbk91dCA9IChlbGVtZW50OiBFbGVtZW50UmVmKSA9PlxuICAgIGFuaW1PdXQoZWxlbWVudCwgdGhpcy5vdXREdXJhdGlvbik7XG5cbiAgZ2V0IHN0eWxlcygpIHtcbiAgICBpZiAoIXRoaXMuX3Bvc2l0aW9uKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmRvbS5ieXBhc3NTZWN1cml0eVRydXN0U3R5bGUoXG4gICAgICBgIHdpZHRoOiAke3RoaXMud2lkdGggPyB0aGlzLndpZHRoICsgJ3B4JyA6ICdhdXRvJ307IFxuICAgICAgICBoZWlnaHQ6ICR7dGhpcy5oZWlnaHQgPyB0aGlzLmhlaWdodCArICdweCcgOiAnYXV0byd9OyBcbiAgICAgICAgbGVmdDogJHt0aGlzLmdldENvbnRhaW5lckxlZnQoKX1weDsgXG4gICAgICAgIHRvcDogJHt0aGlzLmdldENvbnRhaW5lclRvcCgpfXB4O2BcbiAgICApO1xuICB9XG5cbiAgZ2V0IHRyaWFuZ2xlKCkge1xuICAgIGNvbnN0IGlzSG9yaXpvbnRhbCA9IFsnbGVmdCcsICdyaWdodCddLnNvbWUocyA9PiBzID09PSB0aGlzLnBvc2l0aW9uKTtcbiAgICBpZiAoaXNIb3Jpem9udGFsKSB7XG4gICAgICByZXR1cm4gYCR7dGhpcy5hcnJvd0hlaWdodH0sMCAwLCR7dGhpcy5hcnJvd1dpZHRoIC8gMn0gJHtcbiAgICAgICAgdGhpcy5hcnJvd0hlaWdodFxuICAgICAgfSwke3RoaXMuYXJyb3dXaWR0aH1gO1xuICAgIH1cbiAgICByZXR1cm4gYDAsJHt0aGlzLmFycm93SGVpZ2h0fSAke3RoaXMuYXJyb3dXaWR0aCAvIDJ9LDAgJHt0aGlzLmFycm93V2lkdGh9LCR7XG4gICAgICB0aGlzLmFycm93SGVpZ2h0XG4gICAgfWA7XG4gIH1cblxuICBnZXQgc3ZnU3R5bGVzKCkge1xuICAgIGlmICghdGhpcy5fcG9zaXRpb24pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgaXNIb3Jpem9udGFsID0gWydsZWZ0JywgJ3JpZ2h0J10uc29tZShzID0+IHMgPT09IHRoaXMucG9zaXRpb24pO1xuICAgIGNvbnN0IHJvdGF0ZSA9XG4gICAgICAodGhpcy5wb3NpdGlvbiA9PT0gJ2F1dG8nICYmIHRoaXMuX3Bvc2l0aW9uLnZlcnRpY2FsID09PSAnYm90dG9tJykgfHxcbiAgICAgIHRoaXMucG9zaXRpb24gPT09ICdsZWZ0JztcbiAgICByZXR1cm4gdGhpcy5kb20uYnlwYXNzU2VjdXJpdHlUcnVzdFN0eWxlKFxuICAgICAgYGhlaWdodDogJHtpc0hvcml6b250YWwgPyB0aGlzLmFycm93V2lkdGggOiB0aGlzLmFycm93SGVpZ2h0fXB4OyBcbiAgICAgIHdpZHRoOiAke2lzSG9yaXpvbnRhbCA/IHRoaXMuYXJyb3dIZWlnaHQgOiB0aGlzLmFycm93V2lkdGh9cHg7IFxuICAgICAgdG9wOiAke3RoaXMuZ2V0QXJyb3dUb3AoKX1weDsgXG4gICAgICBsZWZ0OiAke3RoaXMuZ2V0QXJyb3dMZWZ0KCl9cHg7XG4gICAgICB0cmFuc2Zvcm06IHJvdGF0ZVooJHtyb3RhdGUgPyAxODAgOiAwfWRlZyk7YFxuICAgICk7XG4gIH1cblxuICBnZXQgYW5pbWF0aW9uU3R5bGVzKCkge1xuICAgIGlmICghdGhpcy5fcG9zaXRpb24pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuZG9tLmJ5cGFzc1NlY3VyaXR5VHJ1c3RTdHlsZShcbiAgICAgIGBoZWlnaHQ6ICR7dGhpcy5hcnJvd0hlaWdodH1weDsgXG4gICAgICB3aWR0aDogJHt0aGlzLmFycm93V2lkdGh9cHg7IFxuICAgICAgdG9wOiAke3RoaXMuZ2V0QXJyb3dUb3AoKX1weDsgXG4gICAgICBsZWZ0OiAke3RoaXMuZ2V0QXJyb3dMZWZ0KCl9cHg7XG4gICAgICB0cmFuc2Zvcm06IHJvdGF0ZVooJHt0aGlzLl9wb3NpdGlvbi52ZXJ0aWNhbCA9PT0gJ2JvdHRvbScgPyAxODAgOiAwfWRlZyk7YFxuICAgICk7XG4gIH1cblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHBsYXRmb3JtOiBQbGF0Zm9ybSxcbiAgICBASG9zdCgpIEBPcHRpb25hbCgpIHByaXZhdGUgY29udGVudDogSW9uQ29udGVudCxcbiAgICBwcml2YXRlIGRvbTogRG9tU2FuaXRpemVyLFxuICAgIHByaXZhdGUgcm91dGVyOiBSb3V0ZXJcbiAgKSB7fVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMucm91dGVyLmV2ZW50c1xuICAgICAgLnBpcGUoXG4gICAgICAgIGZpbHRlcjxOYXZpZ2F0aW9uU3RhcnQ+KGV2ZW50ID0+IGV2ZW50IGluc3RhbmNlb2YgTmF2aWdhdGlvblN0YXJ0KSxcbiAgICAgICAgZmlsdGVyKCgpID0+IHRoaXMuY2xvc2VPbk5hdmlnYXRpb24gJiYgdGhpcy5vdmVybGF5Lm9wZW4pLFxuICAgICAgICB0YXAoKCkgPT4gdGhpcy5jbG9zZSgpKSxcbiAgICAgICAgdGFrZVVudGlsKHRoaXMub25EZXN0cm95JClcbiAgICAgIClcbiAgICAgIC5zdWJzY3JpYmUoKTtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHt9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5vbkRlc3Ryb3kkLm5leHQoKTtcbiAgfVxuXG4gIGNsb3NlKCkge1xuICAgIHRoaXMuYW5pbWF0aW9uT3V0KHRoaXMuYW5pbWF0aW9uQ29udGFpbmVyKVxuICAgICAgLnBpcGUoXG4gICAgICAgIGFmdGVyKCgpID0+IHtcbiAgICAgICAgICB0aGlzLm92ZXJsYXkuaGlkZSgpO1xuICAgICAgICAgIHRoaXMub25DbG9zZSQubmV4dCgpO1xuICAgICAgICB9KVxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRQb3NpdGlvbk9mVGFyZ2V0KHRhcmdldDogSFRNTEVsZW1lbnQpIHtcbiAgICBjb25zdCByZWN0ID0gdGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIHJldHVybiB0aGlzLmNhbGN1bGNhdGVQb3NpdGlvbmluZyhcbiAgICAgIHJlY3QudG9wLFxuICAgICAgcmVjdC5sZWZ0LFxuICAgICAgcmVjdC5ib3R0b20sXG4gICAgICByZWN0LnJpZ2h0LFxuICAgICAgcmVjdC5oZWlnaHQsXG4gICAgICByZWN0LndpZHRoXG4gICAgKTtcbiAgfVxuXG4gIG9wZW4odGFyZ2V0OiBNb3VzZUV2ZW50IHwgRWxlbWVudFJlZikge1xuICAgIGxldCBlbGVtZW50O1xuICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBNb3VzZUV2ZW50KSB7XG4gICAgICBlbGVtZW50ID0gdGFyZ2V0LnRhcmdldCBhcyBIVE1MRWxlbWVudDtcbiAgICB9IGVsc2UgaWYgKHRhcmdldCBpbnN0YW5jZW9mIEVsZW1lbnRSZWYpIHtcbiAgICAgIGVsZW1lbnQgPSB0YXJnZXQubmF0aXZlRWxlbWVudCBhcyBIVE1MRWxlbWVudDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLm9wZW5UYXJnZXQoZWxlbWVudCk7XG4gIH1cblxuICBvcGVuVGFyZ2V0KHRhcmdldDogSFRNTEVsZW1lbnQpIHtcbiAgICBjb25zdCBwb3NpdGlvbiA9IHRoaXMuZ2V0UG9zaXRpb25PZlRhcmdldCh0YXJnZXQpO1xuICAgIHRoaXMub3BlbkF0UG9zaXRpb24odGFyZ2V0LCBwb3NpdGlvbik7XG4gICAgdGhpcy53YXRjaFJlc2l6ZSh0YXJnZXQpO1xuICAgIHRoaXMud2F0Y2hTY3JvbGwodGFyZ2V0KTtcbiAgfVxuXG4gIHByaXZhdGUgd2F0Y2hSZXNpemUodGFyZ2V0OiBIVE1MRWxlbWVudCkge1xuICAgIGZyb21FdmVudCh3aW5kb3csICdyZXNpemUnKVxuICAgICAgLnBpcGUoXG4gICAgICAgIGZsYXRNYXAoKCkgPT4gdGhpcy5maWx0ZXJJblZpZXdwb3J0KHRhcmdldCkpLFxuICAgICAgICB0aHJvdHRsZVRpbWUoNTApLFxuICAgICAgICBtYXAoKCkgPT4gdGhpcy5nZXRQb3NpdGlvbk9mVGFyZ2V0KHRhcmdldCkpLFxuICAgICAgICB0YXAocG9zID0+ICh0aGlzLl9wb3NpdGlvbiA9IHBvcykpLFxuICAgICAgICB0YWtlVW50aWwodGhpcy5vbkRlc3Ryb3kkKVxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZSgpO1xuICB9XG5cbiAgcHJpdmF0ZSB3YXRjaFNjcm9sbCh0YXJnZXQ6IEhUTUxFbGVtZW50KSB7XG4gICAgaWYgKHRoaXMuY29udGVudCAmJiAhdGhpcy5iYWNrZHJvcCkge1xuICAgICAgdGhpcy5jb250ZW50LnNjcm9sbEV2ZW50cyA9IHRydWU7XG4gICAgICBtZXJnZShcbiAgICAgICAgZnJvbUV2ZW50KHdpbmRvdywgJ21vdXNld2hlZWwnKSxcbiAgICAgICAgZnJvbUV2ZW50KHdpbmRvdywgJ3RvdWNobW92ZScpLFxuICAgICAgICB0aGlzLmNvbnRlbnQuaW9uU2Nyb2xsXG4gICAgICApXG4gICAgICAgIC5waXBlKFxuICAgICAgICAgIGZsYXRNYXAoKCkgPT4gdGhpcy5maWx0ZXJJblZpZXdwb3J0KHRhcmdldCkpLFxuICAgICAgICAgIG1hcCgoKSA9PiB0aGlzLmdldFBvc2l0aW9uT2ZUYXJnZXQodGFyZ2V0KSksXG4gICAgICAgICAgdGFwKHBvcyA9PiAodGhpcy5fcG9zaXRpb24gPSBwb3MpKSxcbiAgICAgICAgICB0YWtlVW50aWwodGhpcy5vbkRlc3Ryb3kkKVxuICAgICAgICApXG4gICAgICAgIC5zdWJzY3JpYmUoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGZpbHRlckluVmlld3BvcnQodGFyZ2V0OiBIVE1MRWxlbWVudCkge1xuICAgIHJldHVybiBmcm9tKHRoaXMuaW5WaWV3cG9ydCh0YXJnZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkpKS5waXBlKFxuICAgICAgdGFwKGluVmlld3BvcnQgPT5cbiAgICAgICAgIWluVmlld3BvcnQgPyAodGhpcy5oaWRkZW4gPSB0cnVlKSA6ICh0aGlzLmhpZGRlbiA9IGZhbHNlKVxuICAgICAgKSxcbiAgICAgIGZpbHRlcihpblZpZXdQb3J0ID0+IHRoaXMub3ZlcmxheS5vcGVuICYmIGluVmlld1BvcnQpXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgb3BlbkF0UG9zaXRpb24odGFyZ2V0OiBIVE1MRWxlbWVudCwgcG9zaXRpb246IFBvcG92ZXJQb3NpdGlvbikge1xuICAgIGF3YWl0IHRoaXMuc2Nyb2xsVG9Qb3NpdGlvbih0YXJnZXQsIHBvc2l0aW9uKTtcbiAgICB0aGlzLl9wb3NpdGlvbiA9IHBvc2l0aW9uO1xuICAgIHRoaXMub3ZlcmxheS5zaG93KCk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHNjcm9sbFRvUG9zaXRpb24oXG4gICAgdGFyZ2V0OiBIVE1MRWxlbWVudCxcbiAgICBwb3NpdGlvbjogUG9wb3ZlclBvc2l0aW9uXG4gICkge1xuICAgIGlmICh0aGlzLmNvbnRlbnQgJiYgdGhpcy5zY3JvbGxUb1RhcmdldCkge1xuICAgICAgY29uc3QgaXNJblZpZXdwb3J0ID0gYXdhaXQgdGhpcy5pblZpZXdwb3J0KFxuICAgICAgICB0YXJnZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KClcbiAgICAgICk7XG4gICAgICBpZiAoaXNJblZpZXdwb3J0KSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGF3YWl0IHRoaXMuY29udGVudC5zY3JvbGxUb1BvaW50KFxuICAgICAgICBwb3NpdGlvbi5sZWZ0LFxuICAgICAgICBwb3NpdGlvbi50b3AsXG4gICAgICAgIHRoaXMuc2Nyb2xsU3BlZWRcbiAgICAgICk7XG4gICAgfVxuICB9XG4gIGFzeW5jIGluVmlld3BvcnQocG9zaXRpb246IERPTVJlY3QgfCBDbGllbnRSZWN0KSB7XG4gICAgY29uc3QgaGVpZ2h0ID0gdGhpcy5wbGF0Zm9ybS5oZWlnaHQoKTtcbiAgICBjb25zdCB3aWR0aCA9IHRoaXMucGxhdGZvcm0ud2lkdGgoKTtcblxuICAgIHJldHVybiAoXG4gICAgICBwb3NpdGlvbi50b3AgPD0gaGVpZ2h0ICYmXG4gICAgICBwb3NpdGlvbi5ib3R0b20gPj0gMCAmJlxuICAgICAgcG9zaXRpb24ubGVmdCA8IHdpZHRoICYmXG4gICAgICBwb3NpdGlvbi5yaWdodCA+IDBcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxjYXRlUG9zaXRpb25pbmcoXG4gICAgdG9wOiBudW1iZXIsXG4gICAgbGVmdDogbnVtYmVyLFxuICAgIGJvdHRvbTogbnVtYmVyLFxuICAgIHJpZ2h0OiBudW1iZXIsXG4gICAgdGFyZ2V0SGVpZ2h0OiBudW1iZXIsXG4gICAgdGFyZ2V0V2lkdGg6IG51bWJlclxuICApOiBQb3BvdmVyUG9zaXRpb24ge1xuICAgIC8vIGNhbGN1bGF0ZXMgdGhlIHBvc2l0aW9uIG9mIHRoZSBwb3BvdmVyIHdpdGhvdXQgY29uc2lkZXJpbmcgYXJyb3cgYW5kIG92ZXJsYXkgb2Zmc2V0XG4gICAgY29uc3Qgd2lkdGggPSB0aGlzLnBsYXRmb3JtLndpZHRoKCk7XG4gICAgY29uc3QgaGVpZ2h0ID0gdGhpcy5wbGF0Zm9ybS5oZWlnaHQoKTtcblxuICAgIGNvbnN0IF9sZWZ0ID1cbiAgICAgIHRoaXMucG9zaXRpb24gPT09ICdyaWdodCcgfHxcbiAgICAgICh3aWR0aCAvIDIgPiBsZWZ0ICYmIHRoaXMucG9zaXRpb24gIT09ICdsZWZ0Jyk7XG4gICAgY29uc3QgX3JpZ2h0ID1cbiAgICAgIHRoaXMucG9zaXRpb24gPT09ICdsZWZ0JyB8fFxuICAgICAgKHdpZHRoIC8gMiA8PSBsZWZ0ICYmIHRoaXMucG9zaXRpb24gIT09ICdyaWdodCcpO1xuICAgIGNvbnN0IF90b3AgPVxuICAgICAgdGhpcy5wb3NpdGlvbiA9PT0gJ2JlbG93JyB8fFxuICAgICAgKGhlaWdodCAvIDIgPiB0b3AgJiYgdGhpcy5wb3NpdGlvbiAhPT0gJ2Fib3ZlJyk7XG4gICAgY29uc3QgX2JvdHRvbSA9XG4gICAgICB0aGlzLnBvc2l0aW9uID09PSAnYWJvdmUnIHx8XG4gICAgICAoaGVpZ2h0IC8gMiA8PSB0b3AgJiYgdGhpcy5wb3NpdGlvbiAhPT0gJ2JlbG93Jyk7XG5cbiAgICAvLyB0cmFuc2Zvcm0gb3JpZ2luXG4gICAgbGV0IGhvcml6b250YWw6IFBvcG92ZXJIb3Jpem9udGFsQWxpZ24gPSAnbGVmdCc7XG4gICAgbGV0IHZlcnRpY2FsOiBQb3BvdmVyVmVydGljYWxBbGlnbiA9ICd0b3AnO1xuXG4gICAgaWYgKF9sZWZ0ICYmIF90b3ApIHtcbiAgICAgIC8vIHRvcCBsZWZ0XG4gICAgICBob3Jpem9udGFsID0gJ2xlZnQnO1xuICAgICAgdmVydGljYWwgPSAndG9wJztcbiAgICB9IGVsc2UgaWYgKF9yaWdodCAmJiBfYm90dG9tKSB7XG4gICAgICAvLyBib3R0b20gcmlnaHRcbiAgICAgIGxlZnQgPSByaWdodCAtIHRoaXMud2lkdGg7XG4gICAgICB0b3AgPSBib3R0b20gLSB0aGlzLmhlaWdodDtcbiAgICAgIGhvcml6b250YWwgPSAncmlnaHQnO1xuICAgICAgdmVydGljYWwgPSAnYm90dG9tJztcbiAgICB9IGVsc2UgaWYgKF9yaWdodCAmJiBfdG9wKSB7XG4gICAgICAvLyB0b3AgcmlnaHRcbiAgICAgIGxlZnQgPSByaWdodCAtIHRoaXMud2lkdGg7XG4gICAgICBob3Jpem9udGFsID0gJ3JpZ2h0JztcbiAgICAgIHZlcnRpY2FsID0gJ3RvcCc7XG4gICAgfSBlbHNlIGlmIChfbGVmdCAmJiBfYm90dG9tKSB7XG4gICAgICAvLyBib3R0b20gbGVmdFxuICAgICAgdG9wID0gYm90dG9tIC0gdGhpcy5oZWlnaHQ7XG4gICAgICBob3Jpem9udGFsID0gJ2xlZnQnO1xuICAgICAgdmVydGljYWwgPSAnYm90dG9tJztcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgdG9wLFxuICAgICAgbGVmdCxcbiAgICAgIGJvdHRvbSxcbiAgICAgIHJpZ2h0LFxuICAgICAgdGFyZ2V0SGVpZ2h0LFxuICAgICAgdGFyZ2V0V2lkdGgsXG4gICAgICBob3Jpem9udGFsLFxuICAgICAgdmVydGljYWxcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRBcnJvd1RvcCgpIHtcbiAgICBjb25zdCBpc1ZlcnQgPSBbJ2F1dG8nLCAnYmVsb3cnLCAnYWJvdmUnXS5zb21lKHMgPT4gcyA9PT0gdGhpcy5wb3NpdGlvbik7XG4gICAgaWYgKGlzVmVydCkge1xuICAgICAgcmV0dXJuIHRoaXMuX3Bvc2l0aW9uLnZlcnRpY2FsID09PSAndG9wJ1xuICAgICAgICA/IC0xICogdGhpcy5hcnJvd0hlaWdodFxuICAgICAgICA6IHRoaXMuaGVpZ2h0O1xuICAgIH1cbiAgICBpZiAodGhpcy5hcnJvd1Bvc2l0aW9uID09PSAnY2VudGVyJykge1xuICAgICAgcmV0dXJuIHRoaXMuaGVpZ2h0IC8gMiAtIHRoaXMuYXJyb3dXaWR0aCAvIDI7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9wb3NpdGlvbi52ZXJ0aWNhbCA9PT0gJ3RvcCdcbiAgICAgID8gdGhpcy5fcG9zaXRpb24udGFyZ2V0SGVpZ2h0IC8gMiAtIHRoaXMuYXJyb3dIZWlnaHQgLyAyXG4gICAgICA6IHRoaXMuaGVpZ2h0IC0gdGhpcy5hcnJvd0hlaWdodCAvIDIgLSB0aGlzLl9wb3NpdGlvbi50YXJnZXRIZWlnaHQgLyAyO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRBcnJvd0xlZnQoKSB7XG4gICAgY29uc3QgaXNIb3Jpem9udGFsID0gWydsZWZ0JywgJ3JpZ2h0J10uc29tZShzID0+IHMgPT09IHRoaXMucG9zaXRpb24pO1xuICAgIGlmIChpc0hvcml6b250YWwpIHtcbiAgICAgIHJldHVybiB0aGlzLl9wb3NpdGlvbi5ob3Jpem9udGFsID09PSAnbGVmdCdcbiAgICAgICAgPyAtMSAqIHRoaXMuYXJyb3dIZWlnaHRcbiAgICAgICAgOiB0aGlzLndpZHRoO1xuICAgIH1cbiAgICBpZiAodGhpcy5hcnJvd1Bvc2l0aW9uID09PSAnY2VudGVyJykge1xuICAgICAgcmV0dXJuIHRoaXMud2lkdGggLyAyIC0gdGhpcy5hcnJvd0hlaWdodCAvIDI7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9wb3NpdGlvbi5ob3Jpem9udGFsID09PSAnbGVmdCdcbiAgICAgID8gdGhpcy5fcG9zaXRpb24udGFyZ2V0V2lkdGggLyAyIC0gdGhpcy5hcnJvd1dpZHRoIC8gMlxuICAgICAgOiB0aGlzLndpZHRoIC0gdGhpcy5hcnJvd1dpZHRoIC8gMiAtIHRoaXMuX3Bvc2l0aW9uLnRhcmdldFdpZHRoIC8gMjtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0Q29udGFpbmVyVG9wKCkge1xuICAgIGNvbnN0IGlzVmVydCA9IFsnYXV0bycsICdiZWxvdycsICdhYm92ZSddLnNvbWUocyA9PiBzID09PSB0aGlzLnBvc2l0aW9uKTtcbiAgICBjb25zdCBpc1RvcCA9IHRoaXMuX3Bvc2l0aW9uLnZlcnRpY2FsID09PSAndG9wJztcblxuICAgIGxldCBvZmZzZXQgPSAwO1xuICAgIGlmICh0aGlzLmFycm93ICYmIGlzVG9wKSB7XG4gICAgICBvZmZzZXQgLT0gdGhpcy5nZXRWZXJ0aWNhbEFycm93T2Zmc2V0KCk7XG4gICAgfSBlbHNlIGlmICh0aGlzLmFycm93ICYmICFpc1RvcCkge1xuICAgICAgb2Zmc2V0ICs9IHRoaXMuZ2V0VmVydGljYWxBcnJvd09mZnNldCgpO1xuICAgIH1cbiAgICBpZiAoIWlzVmVydCkge1xuICAgICAgcmV0dXJuIHRoaXMuX3Bvc2l0aW9uLnRvcCArIG9mZnNldDtcbiAgICB9XG4gICAgaWYgKCF0aGlzLm92ZXJsYXlzVGFyZ2V0ICYmIGlzVG9wKSB7XG4gICAgICBvZmZzZXQgKz0gdGhpcy5fcG9zaXRpb24udGFyZ2V0SGVpZ2h0O1xuICAgIH0gZWxzZSBpZiAoIXRoaXMub3ZlcmxheXNUYXJnZXQgJiYgIWlzVG9wKSB7XG4gICAgICBvZmZzZXQgLT0gdGhpcy5fcG9zaXRpb24udGFyZ2V0SGVpZ2h0O1xuICAgIH1cblxuICAgIGlmICh0aGlzLmFycm93ICYmIGlzVG9wKSB7XG4gICAgICBvZmZzZXQgKz0gdGhpcy5hcnJvd0hlaWdodDtcbiAgICB9IGVsc2UgaWYgKHRoaXMuYXJyb3cgJiYgIWlzVG9wKSB7XG4gICAgICBvZmZzZXQgLT0gdGhpcy5hcnJvd0hlaWdodDtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX3Bvc2l0aW9uLnRvcCArIG9mZnNldDtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0VmVydGljYWxBcnJvd09mZnNldCgpIHtcbiAgICBsZXQgb2Zmc2V0ID0gMDtcbiAgICBjb25zdCBpc0hvcml6b250YWwgPSBbJ2xlZnQnLCAncmlnaHQnXS5zb21lKHMgPT4gcyA9PT0gdGhpcy5wb3NpdGlvbik7XG4gICAgaWYgKHRoaXMuYXJyb3dQb3NpdGlvbiA9PT0gJ2NlbnRlcicgJiYgaXNIb3Jpem9udGFsKSB7XG4gICAgICBvZmZzZXQgKz0gdGhpcy5oZWlnaHQgLyAyIC0gdGhpcy5fcG9zaXRpb24udGFyZ2V0SGVpZ2h0IC8gMjtcbiAgICB9XG4gICAgcmV0dXJuIG9mZnNldDtcbiAgfVxuICBwcml2YXRlIGdldEhvcml6b250YWxBcnJvd09mZnNldCgpIHtcbiAgICBsZXQgb2Zmc2V0ID0gMDtcbiAgICBjb25zdCBpc1ZlcnRpY2FsID0gWydhYm92ZScsICdhdXRvJywgJ2JlbG93J10uc29tZShcbiAgICAgIHMgPT4gcyA9PT0gdGhpcy5wb3NpdGlvblxuICAgICk7XG4gICAgaWYgKHRoaXMuYXJyb3dQb3NpdGlvbiA9PT0gJ2NlbnRlcicgJiYgaXNWZXJ0aWNhbCkge1xuICAgICAgb2Zmc2V0ICs9IHRoaXMud2lkdGggLyAyIC0gdGhpcy5fcG9zaXRpb24udGFyZ2V0V2lkdGggLyAyO1xuICAgIH1cbiAgICByZXR1cm4gb2Zmc2V0O1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRDb250YWluZXJMZWZ0KCkge1xuICAgIGNvbnN0IGlzSG9yaXpvbnRhbCA9IFsnbGVmdCcsICdyaWdodCddLnNvbWUocyA9PiBzID09PSB0aGlzLnBvc2l0aW9uKTtcbiAgICBjb25zdCBpc0xlZnQgPSB0aGlzLl9wb3NpdGlvbi5ob3Jpem9udGFsID09PSAnbGVmdCc7XG5cbiAgICBsZXQgb2Zmc2V0ID0gMDtcbiAgICBpZiAodGhpcy5hcnJvdyAmJiBpc0xlZnQpIHtcbiAgICAgIG9mZnNldCAtPSB0aGlzLmdldEhvcml6b250YWxBcnJvd09mZnNldCgpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5hcnJvdyAmJiAhaXNMZWZ0KSB7XG4gICAgICBvZmZzZXQgKz0gdGhpcy5nZXRIb3Jpem9udGFsQXJyb3dPZmZzZXQoKTtcbiAgICB9XG5cbiAgICBpZiAoIWlzSG9yaXpvbnRhbCkge1xuICAgICAgcmV0dXJuIHRoaXMuX3Bvc2l0aW9uLmxlZnQgKyBvZmZzZXQ7XG4gICAgfVxuICAgIGlmICghdGhpcy5vdmVybGF5c1RhcmdldCAmJiBpc0xlZnQpIHtcbiAgICAgIG9mZnNldCArPSB0aGlzLl9wb3NpdGlvbi50YXJnZXRXaWR0aDtcbiAgICB9IGVsc2UgaWYgKCF0aGlzLm92ZXJsYXlzVGFyZ2V0ICYmICFpc0xlZnQpIHtcbiAgICAgIG9mZnNldCAtPSB0aGlzLl9wb3NpdGlvbi50YXJnZXRXaWR0aDtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5hcnJvdyAmJiBpc0xlZnQpIHtcbiAgICAgIG9mZnNldCArPSB0aGlzLmFycm93SGVpZ2h0O1xuICAgIH0gZWxzZSBpZiAodGhpcy5hcnJvdyAmJiAhaXNMZWZ0KSB7XG4gICAgICBvZmZzZXQgLT0gdGhpcy5hcnJvd0hlaWdodDtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX3Bvc2l0aW9uLmxlZnQgKyBvZmZzZXQ7XG4gIH1cbn1cbiJdfQ==